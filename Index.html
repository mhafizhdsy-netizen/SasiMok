<!DOCTYPE SasiMok html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>SasiMok - Social Media Downloader</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"> 
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%231DB954'/><path fill='white' d='M25 50h50l-25 25zM45 25v35'/><path fill='white' d='M45 25v35'></path><path fill='white' d='M25 50h50l-25 25z'></path></svg>" />

    <style>
        /* Variabel Warna */
        :root {
                      --bg: #f9fafb;
            --card: #ffffff;
            --text: #111111;
            --accent: #1DB954; /* Warna khas Spotify */
            --accent-light: #e6f9ed; /* Lebih hijau muda */
            --border: #e5e7eb;
            --shadow: rgba(0, 0, 0, 0.05);
            --subtext: #6b7280;
            --transition-speed: 0.3s; /* Variabel untuk transisi */
            --error-color: #f44336; /* Warna Merah untuk Error */
        }

        body.dark {
            --bg: #121212; /* Darker Spotify BG */
            --card: #181818;
            --text: #ffffff;
            --accent: #1ED760; /* Hijau lebih terang untuk dark mode */
            --accent-light: #20352e;
            --border: #30363d;
            --shadow: rgba(255, 255, 255, 0.05);
            --subtext: #b3b3b3;
            --error-color: #ff5252;
        }

        /* Reset dan Transisi Global */
        * {
            box-sizing: border-box;
            transition: background var(--transition-speed) ease,
                        color var(--transition-speed) ease,
                        border-color var(--transition-speed) ease,
                        transform var(--transition-speed) ease,
                        opacity var(--transition-speed) ease;
        }

        /* FONT DAN TATA LETAK UTAMA */
        body {
            background: var(--bg);
            color: var(--text);
            font-family: "Inter", sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        
        h1 { font-weight: 700; font-size: 1.8rem; margin-bottom: 8px;} /* Reduced margin */
        .subtitle { font-weight: 500; color: var(--subtext); margin-bottom: 25px; } /* Reduced margin */
        
        /* Header & Logo */
        header {
            width: 100%;
            background: var(--card);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px; /* Reduced padding */
            box-shadow: 0 1px 6px var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            font-weight: 700;
            font-size: 1.2rem; /* Reduced font size */
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 6px; /* Reduced gap */
        }
        
        /* Gaya Logo Adaptif BARU */
        .logo-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px; /* Reduced size */
            height: 28px; /* Reduced size */
            border-radius: 6px;
            font-size: 1rem; /* Reduced font size */
            color: var(--card); /* Warna ikon (putih) */
            background-color: var(--accent); /* Warna latar (hijau) */
            transition: var(--transition-speed);
        }
        
        /* Pastikan logo tetap terlihat di Dark Mode */
        body.dark .logo-icon {
            background-color: var(--accent); /* Hijau terang */
            color: #fff; /* Putih */
        }
        
        .header-icon-button {
            background: none;
            border: none;
            font-size: 1.2rem; /* Reduced font size */
            color: var(--text);
            cursor: pointer;
            padding: 4px; /* Reduced padding */
        }

        /* Toggle Tema */
        .theme-toggle {
            position: relative;
            width: 58px; /* Reduced width */
            height: 28px; /* Reduced height */
            background: var(--accent-light);
            border-radius: 28px;
            cursor: pointer;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 6px; /* Adjusted padding */
        }
        
        .toggle-circle {
            position: absolute;
            top: 2px; /* Adjusted position */
            left: 2px; /* Adjusted position */
            width: 24px; /* Reduced size */
            height: 24px; /* Reduced size */
            background: var(--card);
            border-radius: 50%;
            box-shadow: 0 1px 4px var(--shadow); /* Reduced shadow */
            display: flex;
            align-items: center;
            justify-content: center;
            transition: left var(--transition-speed) ease, background var(--transition-speed) ease;
        }
        
        body.dark .toggle-circle {
            left: 30px; /* Adjusted position */
            background: var(--accent);
        }
        
        body.dark .toggle-circle i {
            color: #fff;
        }

        /* Main Content */
        main {
            max-width: 480px;
            width: 90%;
            padding: 30px 0; /* Reduced padding */ 
            text-align: center;
            flex-shrink: 0;
        }
        
        /* Input dan Button */
        .input-group {
            display: flex;
            background: var(--bg); 
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border);
            margin-bottom: 15px; /* Reduced margin */
        }
        input {
            flex: 1;
            border: none;
            outline: none;
            padding: 14px 15px; /* Adjusted padding */
            background: transparent;
            color: var(--text); 
            font-size: 1rem;
            font-weight: 500;
        }

        button.paste-btn {
            background: var(--accent);
            color: #fff;
            font-weight: 600;
            border: none;
            padding: 0 15px; /* Adjusted padding */
            cursor: pointer;
        }
        
        button.download-btn {
            background: var(--accent);
            color: #fff;
            border: none;
            width: 100%;
            padding: 14px; /* Adjusted padding */
            border-radius: 12px;
            font-size: 1rem; /* Reduced font size */
            font-weight: 600; 
            cursor: pointer;
            box-shadow: 0 3px 8px rgba(0, 122, 255, 0.2); /* Reduced shadow */
            text-decoration: none;
        }

        /* === RESULT BOXES === */
        .info-box, .media-result-box {
            display: none;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            margin-top: 20px; /* Reduced margin */
            padding: 20px; /* Reduced padding */
            box-shadow: 0 3px 8px var(--shadow); /* Reduced shadow */
            text-align: left;
            opacity: 0;
            transform: translateY(15px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        
        .info-box.visible, .media-result-box.visible {
            opacity: 1;
            transform: translateY(0);
            display: block; 
        }
        
        .media-result-box.no-info-box {
             margin-top: 30px; /* Reduced margin */
             border-top-left-radius: 16px;
             border-top-right-radius: 16px;
        }

        /* Style untuk Title (hanya pembatasan visual) */
        .video-title {
            font-weight: 700;
            font-size: 1.1rem; /* Reduced font size */
            margin-bottom: 10px; /* Reduced margin */
            overflow: hidden;
            max-height: 48px; /* Adjusted max-height for 2 lines */
            position: relative;
            text-align: left;
        }

        /* STYLES UNTUK CHIP AUTHOR/UNIQUE ID */
        .author-info-row {
            display: flex;
            gap: 8px; /* Reduced gap */
            margin-bottom: 0;
            flex-wrap: wrap; 
        }

        .author-chip, .unique-id-chip {
            display: inline-flex;
            align-items: center;
            padding: 5px 10px; /* Reduced padding */
            border-radius: 16px; /* Adjusted border radius */
            font-size: 0.85rem; /* Reduced font size */
            font-weight: 600;
        }

        .author-chip {
            background: var(--accent-light);
            color: var(--accent);
        }

        .unique-id-chip {
            background: var(--border);
            color: var(--subtext);
        }

        /* === TAB FILTER === */
        #mediaFilterTabs {
            display: flex;
            gap: 8px; /* Reduced gap */
            margin-bottom: 20px; /* Reduced margin */
            width: 100%; 
            padding-bottom: 5px; 
        }

        .tab-btn {
            flex: 1; 
            min-width: 0; 
            background: var(--bg); 
            border: 1px solid var(--border);
            padding: 8px 12px; /* Reduced padding */
            border-radius: 10px; /* Reduced border radius */
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem; /* Reduced font size */
            color: var(--subtext);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center; 
            gap: 6px; /* Reduced gap */
        }

        .tab-btn:hover {
            background: var(--accent-light);
            color: var(--accent);
            border-color: var(--accent-light);
        }

        .tab-btn.active {
            background: var(--accent);
            color: #fff;
            border-color: var(--accent);
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
            transform: translateY(-1px); 
        }
        
        .tab-btn.active:hover {
             background: var(--accent); 
             color: #fff;
        }
        
        /* Media List View Styles */
        .media-content-container { min-height: 100px; }
        .media-list-view { display: none; flex-direction: column; gap: 15px; } /* Reduced gap */
        .media-list-view.active { display: flex; }
        .media-list-item {
            border: 1px solid var(--border); border-radius: 12px; overflow: hidden;
            background: var(--bg); padding: 12px; /* Reduced padding */
            display: flex;
            flex-direction: column; align-items: center; opacity: 0; 
            transform: translateY(10px); animation: fadeInItem 0.4s forwards;
        }
        @keyframes fadeInItem { to { opacity: 1; transform: translateY(0); } }
        .media-list-item img, .media-list-item video {
            width: 100%; height: auto; max-height: 400px; object-fit: contain;
            border-radius: 8px; background: #000; margin-bottom: 12px; /* Reduced margin */
            display: block;
        }
        
        /* === CUSTOM AUDIO PLAYER STYLES === */
        /* Sembunyikan player bawaan browser */
        .media-list-item audio {
            display: none; 
        }

        .custom-audio-player {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 8px; /* Reduced gap */
            padding: 8px 12px; /* Reduced padding */
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--card); /* Menggunakan card background */
            margin-bottom: 12px; /* Reduced margin */
        }

        .player-controls {
            display: flex;
            align-items: center;
            gap: 12px; /* Reduced gap */
        }

        .player-button {
            background: var(--accent);
            color: #fff;
            border: none;
            width: 36px; /* Reduced size */
            height: 36px; /* Reduced size */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.9rem; /* Reduced font size */
            flex-shrink: 0;
            padding: 0;
        }

        .player-progress-container {
            flex-grow: 1;
            height: 6px; /* Reduced height */
            background: var(--border);
            border-radius: 4px;
            position: relative;
            cursor: pointer;
        }

        .player-progress-bar {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 0%;
            background: var(--accent);
            border-radius: 4px;
        }

        .player-time {
            font-size: 0.8rem; /* Reduced font size */
            color: var(--subtext);
            width: 65px; /* Reduced width */
            text-align: right;
            flex-shrink: 0;
        }
        /* === END CUSTOM AUDIO PLAYER STYLES === */


        .media-info { width: 100%; padding: 0 2px; text-align: left; margin-bottom: 8px; } /* Adjusted padding/margin */
        .media-list-item .link-btn {
            display: block; text-decoration: none; background: var(--accent);
            color: #fff; padding: 10px 15px; /* Reduced padding */
            border-radius: 8px; /* Reduced border radius */
            font-weight: 600; text-transform: uppercase; margin-top: 8px; /* Reduced margin */
            box-shadow: 0 2px 6px rgba(0, 122, 255, 0.2); /* Reduced shadow */
            text-align: center;
            width: 100%; 
        }
        
        /* Style untuk Placeholder Audio/Kosong */
        .audio-placeholder {
            text-align: center; padding: 15px; /* Reduced padding */
            border: 1px dashed var(--border);
            border-radius: 12px; background: var(--bg); margin-top: 10px;
        }
        .audio-placeholder p { 
            font-weight: 500; 
            color: var(--subtext); 
            margin: 0; 
        }

        /* === PERBAIKAN MODAL LOADING (LEBIH KECIL, FIT, SIMPLE) === */
        .popup-overlay {
            display: none; 
            position: fixed; 
            inset: 0;
            background: rgba(0, 0, 0, 0.7); 
            justify-content: center; 
            align-items: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity var(--transition-speed) ease;
        }
        .popup-overlay.show { display: flex; opacity: 1; }
        
        .modal-content-box {
            background: var(--card); 
            padding: 20px; /* Reduced padding */
            border-radius: 12px; /* Reduced border radius */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); 
            max-width: 300px; /* Reduced max-width for about modal */
            width: 85%; 
            text-align: center; 
            transform: scale(0.95);
            transition: transform var(--transition-speed) ease;
        }
        .popup-overlay.show .modal-content-box { transform: scale(1); }
        
        .loading-popup .modal-content-box {
            /* *** FOKUS PENGECILAN MODAL LOADING *** */
            padding: 15px 20px; /* Sangat dikurangi */
            max-width: 200px; /* Dibuat fit */
            width: auto; /* Mengikuti konten */
            display: flex;
            flex-direction: row; /* Dibuat horizontal */
            align-items: center; /* MEMASTIKAN SPINNER DAN TEKS SEJAJAR VERTICAL */
            gap: 12px;
        }
        
        .about-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px; /* Reduced margin */
            padding-bottom: 8px; /* Reduced padding */
            border-bottom: 1px solid var(--border);
        }
        
        .about-modal-header h3 {
            margin: 0;
            font-size: 1.2rem; /* Reduced font size */
        }

        .about-modal-close-btn {
            background: none;
            border: none;
            color: var(--subtext);
            font-size: 1.4rem; /* Reduced font size */
            cursor: pointer;
        }
        /* End Perbaikan Modal CSS */

        /* === PERBAIKAN SPINNER (PROGRESS BAR CIRCLE) === */
        .spinner {
            border: 3px solid var(--border); 
            border-top: 3px solid var(--accent); 
            border-radius: 50%; 
            width: 24px; 
            height: 24px; 
            animation: spin 1s linear infinite;
            /* PROPERTI TAMBAHAN UNTUK LINGKARAN SEMPURNA */
            box-sizing: border-box; 
            flex-shrink: 0; 
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        /* === END PERBAIKAN SPINNER === */
        
        /* Drawer (Dipertahankan) */
        .drawer-overlay {
            display: none; position: fixed; inset: 0; 
            background: rgba(0, 0, 0, 0.4); 
            z-index: 200; opacity: 0; 
            transition: opacity var(--transition-speed) ease;
        }
        .drawer-overlay.open { display: block; opacity: 1; }
        .drawer {
            position: fixed; top: 0; right: 0; width: 260px; /* Reduced width */
            height: 100%;
            background: var(--card); 
            box-shadow: -6px 0 20px rgba(0, 0, 0, 0.3); 
            z-index: 250; 
            transform: translateX(100%);
            transition: transform var(--transition-speed) ease-in-out;
            padding: 15px; /* Reduced padding */
            display: flex; 
            flex-direction: column;
        }
        .drawer.open { transform: translateX(0); }
        .drawer-header {
            display: flex; justify-content: space-between; align-items: center;
            padding-bottom: 12px; /* Reduced padding */
            border-bottom: 1px solid var(--border); margin-bottom: 15px; /* Reduced margin */
        }
        .drawer-header .logo { font-size: 1.3rem; } /* Reduced font size */
        .drawer-close-btn { 
            background: none; border: none; color: var(--subtext); 
            font-size: 1.5rem; cursor: pointer; padding: 5px;
        }
        .drawer-link {
            display: block; text-decoration: none; color: var(--text);
            padding: 10px 0; /* Reduced padding */
            border-bottom: 1px solid var(--border);
            font-weight: 600; font-size: 1rem; /* Reduced font size */
            display: flex;
            align-items: center; gap: 10px;
        }
        .drawer-link:hover { color: var(--accent); }
        /* End Drawer */
        
        footer {
            margin-top: 30px; /* Reduced margin */
            padding: 15px; /* Reduced padding */
            width: 100%; text-align: center;
            color: var(--subtext); font-size: 0.85rem;
        }

        /* === Media Queries (Responsif) === */
        @media (max-width: 400px) {
            /* Paste button hides text on very small screens */
            button.paste-btn span {
                display: none;
            }
            button.paste-btn {
                padding: 0 12px;
            }

            /* Tabs become slightly smaller */
            .tab-btn {
                padding: 7px 10px;
                font-size: 0.85rem;
            }

            /* Title size adjustment */
            h1 {
                font-size: 1.6rem;
            }
        }
    </style>
</head>

<body>
    <header>
        <div class="logo">
            <div class="logo-icon"><i class="fa-solid fa-download"></i></div> 
            <span>SasiMok</span>
        </div>
        <div style="display: flex; align-items: center; gap: 10px;">
            <div class="theme-toggle" id="themeToggle">
                <div class="toggle-circle"><i class="fa-solid fa-sun"></i></div>
            </div>
            <button class="header-icon-button" id="openDrawerBtn">
                <i class="fa-solid fa-bars"></i>
            </button>
        </div>
    </header>

    <main>
        <h1>SasiMok Social Media Downloader</h1>
        <p class="subtitle">Unduh Video/Gambar dari berbagai platform, tanpa watermark.</p>

        <div class="input-group">
            <input id="tiktokUrl" type="text" placeholder="Tempelkan tautan di sini (TikTok, IG, dll.)">
            <button class="paste-btn" id="pasteBtn"><i class="fa-solid fa-paste"></i><span> Tempel</span></button>
        </div>

        <button class="download-btn" id="fetchBtn"><i class="fa-solid fa-arrow-down"></i> Unduh Sekarang </button>

        <div class="info-box" id="infoBox">
            <div class="video-title" id="videoTitle"></div>
            
            <div class="author-info-row">
                <div class="author-chip" id="authorName"></div>
                <div class="unique-id-chip" id="authorUniqueId"></div>
            </div>
        </div>

        <div class="media-result-box" id="mediaResultBox">
            
            <div id="mediaFilterTabs">
                <button class="tab-btn active" data-type="video"><i class="fa-solid fa-video"></i> Video</button>
                <button class="tab-btn" data-type="image"><i class="fa-solid fa-image"></i> Gambar</button>
                <button class="tab-btn" data-type="audio"><i class="fa-solid fa-music"></i> Audio</button>
            </div>
            
            <div class="media-content-container">
                <div class="media-list-view active" data-content="video" id="videoListView">
                    <p style="text-align: center; color: var(--subtext);">Belum ada media video.</p>
                </div>
                <div class="media-list-view" data-content="image" id="imageListView">
                    <p style="text-align: center; color: var(--subtext);">Belum ada media gambar.</p>
                </div>
                
                <div class="media-list-view" data-content="audio" id="audioListView">
                    <div class="audio-placeholder">
                        <p><i class="fa-solid fa-music"></i> Tidak ada file audio yang diekstrak.</p>
                    </div>
                </div>
            </div>

        </div>
    </main>
    
    <div class="loading-popup popup-overlay" id="loadingPopup">
        <div class="modal-content-box">
            <div class="spinner"></div>
            <div class="loading-text" style="font-weight: 600;">Memproses...</div>
        </div>
    </div>
    
    <div class="alert-popup popup-overlay" id="infoAlertModal">
        <div class="modal-content-box">
            <div class="about-modal-header" style="justify-content: center; border-bottom: none; padding-bottom: 0; margin-bottom: 15px;">
                <h3 id="alertHeader" style="display: flex; align-items: center; gap: 8px;">
                    <i class="fa-solid fa-triangle-exclamation" style="color: var(--error-color);"></i> Perhatian
                </h3> 
            </div>
            <p id="alertMessage" style="margin-bottom: 20px; color: var(--text);"></p>
            <button class="download-btn" id="closeAlertModalBtn" style="background: var(--accent); width: 100%;">OK</button>
        </div>
    </div>
    <div class="drawer-overlay" id="drawerOverlay"></div>

    <div class="drawer" id="appDrawer">
        <div class="drawer-header">
            <span class="logo"><i class="fa-solid fa-bars"></i> Menu</span>
            <button class="drawer-close-btn" id="closeDrawerBtn">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>
        <nav>
            <a href="#" class="drawer-link" id="showAboutModalLink"><i class="fa-solid fa-circle-info"></i> Tentang Aplikasi</a>
            <a href="https://github.com/riopart" target="_blank" class="drawer-link"><i class="fa-brands fa-github"></i> GitHub Project</a>
            <a href="#" class="drawer-link" onclick="closeDrawer(); showAlertModal('Fitur ini sedang dalam pengembangan dan akan segera tersedia.', 'Segera Hadir'); return false;"><i class="fa-solid fa-gear"></i> Pengaturan</a>
        </nav>
    </div>
    <div class="about-modal popup-overlay" id="aboutModal">
        <div class="modal-content-box">
            <div class="about-modal-header">
                <h3><i class="fa-solid fa-circle-info"></i> Tentang SasiMok</h3>
                <button class="about-modal-close-btn" id="closeAboutModalBtn">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <p>Aplikasi ini dibuat sebagai demonstrasi kemampuan *web scraping* dan API *fetching* untuk mengunduh media dari berbagai platform sosial.</p>
            <p style="font-size: 0.9em; margin-top: 15px;">Dibuat oleh Rio.</p>
        </div>
    </div>
    <footer>
        <div class="footer-bottom">
            © 2025 Rio. <strong>SasiMok</strong> — Social Media Downloader
        </div>
    </footer>

    <script>
        const fetchBtn = document.getElementById("fetchBtn");
        const infoBox = document.getElementById("infoBox");
        const mediaResultBox = document.getElementById("mediaResultBox"); 
        const tiktokUrlInput = document.getElementById("tiktokUrl");
        const loadingPopup = document.getElementById("loadingPopup");
        const aboutModal = document.getElementById("aboutModal"); 
        const appDrawer = document.getElementById("appDrawer");
        const drawerOverlay = document.getElementById("drawerOverlay"); 
        const showAboutModalLink = document.getElementById("showAboutModalLink"); 
        const closeAboutModalBtn = document.getElementById("closeAboutModalBtn");
        const TRANSITION_DURATION = 300; 
        
        // Elemen Result
        const videoListView = document.getElementById("videoListView");
        const imageListView = document.getElementById("imageListView");
        const audioListView = document.getElementById("audioListView");
        const mediaFilterTabs = document.getElementById("mediaFilterTabs");
        
        const videoTitleElement = document.getElementById("videoTitle");
        const authorNameElement = document.getElementById("authorName");
        const authorUniqueIdElement = document.getElementById("authorUniqueId");

        // Elemen Modal Alert Baru
        const infoAlertModal = document.getElementById("infoAlertModal");
        const alertMessageElement = document.getElementById("alertMessage");
        const closeAlertModalBtn = document.getElementById("closeAlertModalBtn");
        const alertHeader = document.getElementById("alertHeader");

        
        const TITLE_CHAR_LIMIT = 80; 

        
        let currentMediaData = null; 
        
        // ===================================================
        // KONFIGURASI API (HARAP GANTI KEY DI BAWAH INI)
        // ===================================================
        const API_ENDPOINT = "https://download-all-in-one-budget.p.rapidapi.com/v1/social/autolink";
        const RAPID_API_KEY = "55422bdc0bmshf45ca0637296027p19fd04jsn5654c69ca1d4";
        const RAPID_API_HOST = "download-all-in-one-budget.p.rapidapi.com";

        // ===================================================
        // FUNGSI UTILITY & MODAL/DRAWER
        // ===================================================

        const isValidString = (value) => {
            return typeof value === 'string' && value.trim().length > 0;
        };

        const showModal = (element) => {
            element.style.display = 'flex';
            setTimeout(() => {
                element.classList.add('show');
            }, 10);
        };

        const hideModal = (element) => {
            element.classList.remove('show');
            setTimeout(() => {
                element.style.display = 'none';
            }, TRANSITION_DURATION);
        };

        // FUNGSI BARU UNTUK ALERT
        function showAlertModal(message, title = "Perhatian") {
            const isError = title.toLowerCase().includes("kesalahan") || title.toLowerCase().includes("gagal");
            const icon = isError ? 
                `<i class="fa-solid fa-circle-exclamation" style="color: var(--error-color);"></i>` : 
                `<i class="fa-solid fa-triangle-exclamation" style="color: var(--accent);"></i>`;
                
            alertHeader.innerHTML = `${icon} ${title}`;
            alertMessageElement.textContent = message;
            showModal(infoAlertModal);
        }
        
        // Event Listener untuk Modal dan Drawer
        aboutModal.addEventListener('click', (e) => {
            if (e.target === aboutModal) {
                hideModal(aboutModal);
            }
        });

        closeAboutModalBtn.addEventListener('click', () => {
             hideModal(aboutModal);
        });
        
        // Event Listener untuk Modal Alert
        closeAlertModalBtn.addEventListener('click', () => {
            hideModal(infoAlertModal);
        });
        infoAlertModal.addEventListener('click', (e) => {
            if (e.target === infoAlertModal) {
                hideModal(infoAlertModal);
            }
        });


        const openDrawer = () => {
            appDrawer.classList.add("open");
            drawerOverlay.classList.add("open");
            drawerOverlay.style.display = 'block';
        };

        const closeDrawer = () => {
            appDrawer.classList.remove("open");
            drawerOverlay.classList.remove("open");
            setTimeout(() => {
                 drawerOverlay.style.display = 'none';
            }, TRANSITION_DURATION);
        };
        
        // FUNGSI BARU: Format waktu detik ke M:SS
        function formatTime(seconds) {
            if (isNaN(seconds)) return "0:00";
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        }
        
        // FUNGSI BARU: Pengecekan URL YouTube
        function isYouTubeUrl(url) {
            return url.includes('youtube.com') || url.includes('youtu.be');
        }

        // ===================================================
        // LOGIKA RENDER MEDIA
        // ===================================================

        function renderMediaItem(media, data) {
            if (!media.downloadUrl) return null;

            const item = document.createElement('div');
            item.classList.add('media-list-item');
            
            let mediaElement = '';
            let itemTitle = '';
            let mediaQuality = media.quality ? media.quality.replace(/_/g, ' ').toUpperCase() : 'Standar';

            if (media.type === 'video') {
                itemTitle = 'VIDEO';
                mediaElement = `
                    <video controls muted playsinline class="cover" 
                        poster="${media.displayUrl || ''}">
                        <source src="${media.downloadUrl}" type="video/mp4">
                    </video>`;
            } else if (media.type === 'image') {
                itemTitle = 'GAMBAR';
                mediaElement = `
                    <img class="cover" src="${media.downloadUrl}" alt="${media.quality}">`; 
                    
                // Jika itu thumbnail YouTube, kita berikan nama file yang lebih spesifik
                if (media.isThumbnail) {
                    itemTitle = 'THUMBNAIL';
                    mediaQuality = media.quality.replace(/-/g, ' ').toUpperCase();
                }
            } else if (media.type === 'audio') { 
                itemTitle = 'AUDIO';
                if (mediaQuality === 'STANDAR') {
                    mediaQuality = media.extension === 'mp3' ? 'MP3' : 'Audio Utama';
                }
                
                const uniqueId = `audio-${Date.now()}-${Math.random().toString(36).substring(2, 9)}`;

                // === CUSTOM AUDIO PLAYER HTML BARU ===
                mediaElement = `
                    <audio id="${uniqueId}" src="${media.downloadUrl}" preload="none"></audio>
                    <div class="custom-audio-player" data-audio-id="${uniqueId}">
                        <div class="player-controls">
                            <button class="player-button" data-action="play"><i class="fa-solid fa-play"></i></button>
                            <div class="player-progress-container">
                                <div class="player-progress-bar"></div>
                            </div>
                            <span class="player-time">0:00 / 0:00</span>
                        </div>
                    </div>
                `;
            } else {
                return null;
            }

            // ATRIBUT 'download' DIHAPUS DARI TAG <a>
            item.innerHTML = `
                ${mediaElement}
                <div class="media-info">
                    <strong>Kualitas:</strong> ${mediaQuality}
                </div>
                <a href="${media.downloadUrl}" class="link-btn" target="_blank">
                    <i class="fa-solid fa-download"></i> UNDUH ${itemTitle}
                </a>
            `;
            return item;
        }

        function renderAllMedia(mediaGroups, data) {
            videoListView.innerHTML = '';
            imageListView.innerHTML = '';
            audioListView.innerHTML = '';
            
            let counts = { video: 0, image: 0, audio: 0 };
            
            // 1. Render Visual Media (Video/Image API)
            mediaGroups.visual.forEach(media => {
                const item = renderMediaItem(media, data);
                if (item) {
                    if (media.type === 'video') {
                        videoListView.appendChild(item);
                        counts.video++;
                    } else if (media.type === 'image' && !media.isThumbnail) {
                        imageListView.appendChild(item);
                        counts.image++;
                    }
                }
            });
            
            // 2. Render Thumbnail YouTube (Jika Ada)
            mediaGroups.youtubeThumbnails.forEach(media => {
                const item = renderMediaItem(media, data);
                if (item) {
                    imageListView.appendChild(item);
                    counts.image++;
                }
            });
            
            // 3. Render Audio Media
            mediaGroups.audio.forEach(media => {
                const item = renderMediaItem(media, data);
                if (item) {
                    audioListView.appendChild(item);
                    counts.audio++;
                }
            });


            if (counts.video === 0) {
                 videoListView.innerHTML = '<p style="text-align: center; color: var(--subtext);">Tidak ada media video yang ditemukan.</p>';
            }
            if (counts.image === 0) {
                 imageListView.innerHTML = '<p style="text-align: center; color: var(--subtext);">Tidak ada media gambar yang ditemukan.</p>';
            }

            if (counts.audio === 0) {
                audioListView.innerHTML = `
                    <div class="audio-placeholder">
                        <p><i class="fa-solid fa-music"></i> Tidak ada file audio yang diekstrak.</p>
                    </div>
                `;
            }

            
            let defaultActiveType = 'video';
            if (counts.video === 0 && counts.image > 0) {
                defaultActiveType = 'image';
            } else if (counts.video === 0 && counts.image === 0 && counts.audio > 0) {
                defaultActiveType = 'audio';
            }
            setActiveTab(defaultActiveType);
        }

        function setActiveTab(mediaType) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.media-list-view').forEach(view => view.classList.remove('active'));

            const activeBtn = document.querySelector(`.tab-btn[data-type="${mediaType}"]`);
            const activeContent = document.querySelector(`.media-list-view[data-content="${mediaType}"]`);
            
            if (activeBtn) activeBtn.classList.add('active');
            if (activeContent) activeContent.classList.add('active');

            setTimeout(() => {
                mediaResultBox.scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }
        
        function setupTitle(titleText) {
            if (titleText.length > TITLE_CHAR_LIMIT) {
                 videoTitleElement.textContent = titleText.substring(0, TITLE_CHAR_LIMIT) + '...';
            } else {
                 videoTitleElement.textContent = titleText;
            }
        }
        
        // FUNGSI BARU: Inisialisasi dan Logika Player Audio Kustom
        function initializeAudioPlayers() {
            // Hentikan semua audio yang mungkin sedang diputar
            document.querySelectorAll('audio').forEach(a => a.pause()); 
            
            const players = document.querySelectorAll('.custom-audio-player');
            
            players.forEach(playerDiv => {
                const audioId = playerDiv.getAttribute('data-audio-id');
                const audio = document.getElementById(audioId);
                
                if (!audio) return;
                
                const playBtn = playerDiv.querySelector('.player-button');
                const progressBarContainer = playerDiv.querySelector('.player-progress-container');
                const progressBar = playerDiv.querySelector('.player-progress-bar');
                const timeDisplay = playerDiv.querySelector('.player-time');
                
                // 1. Play/Pause Logic
                playBtn.onclick = () => {
                    // Jeda semua audio lain yang sedang aktif
                    document.querySelectorAll('audio').forEach(a => {
                        if (a !== audio && !a.paused) {
                            a.pause();
                            const otherPlayerDiv = document.querySelector(`.custom-audio-player[data-audio-id="${a.id}"]`);
                            if(otherPlayerDiv) {
                                 // Ganti ikon kembali ke play
                                 otherPlayerDiv.querySelector('.player-button').innerHTML = '<i class="fa-solid fa-play"></i>';
                            }
                        }
                    });

                    if (audio.paused || audio.ended) {
                        // Jika audio baru dimuat/seek, pastikan metadata sudah siap untuk menampilkan durasi
                        if (audio.readyState === 0) {
                            audio.load();
                        }
                        audio.play();
                        playBtn.innerHTML = '<i class="fa-solid fa-pause"></i>';
                    } else {
                        audio.pause();
                        playBtn.innerHTML = '<i class="fa-solid fa-play"></i>';
                    }
                };
                
                // 2. Time Update (Progress Bar & Time Text)
                audio.onloadedmetadata = () => {
                    timeDisplay.textContent = `0:00 / ${formatTime(audio.duration)}`;
                };

                audio.ontimeupdate = () => {
                    const duration = audio.duration;
                    const currentTime = audio.currentTime;
                    
                    if (!isNaN(duration)) {
                        const progressPercent = (currentTime / duration) * 100;
                        progressBar.style.width = `${progressPercent}%`;
                        timeDisplay.textContent = `${formatTime(currentTime)} / ${formatTime(duration)}`;
                    }
                };

                // 3. Ended state
                audio.onended = () => {
                    playBtn.innerHTML = '<i class="fa-solid fa-rotate-right"></i>'; // Ikon putar ulang
                    audio.currentTime = 0; 
                };

                // 4. Seek functionality (Klik pada progress bar)
                progressBarContainer.onclick = (e) => {
                    const rect = progressBarContainer.getBoundingClientRect();
                    // Hitung posisi klik relatif terhadap lebar bar
                    const clickX = e.clientX - rect.left;
                    const width = rect.width;
                    const duration = audio.duration;
                    
                    if (!isNaN(duration)) {
                         const newTime = (clickX / width) * duration;
                         audio.currentTime = newTime;
                         
                         // Mulai putar jika di-seek saat paused
                         if (audio.paused) {
                             audio.play();
                             playBtn.innerHTML = '<i class="fa-solid fa-pause"></i>';
                         }
                    }
                };
            });
        }

        // Fetch Button Logic 
        fetchBtn.addEventListener("click", async () => {
            const url = tiktokUrlInput.value.trim();
            // Diganti dari alert()
            if (!url) return showAlertModal("Masukkan tautan media sosial terlebih dahulu!", "Kesalahan Input");
            
            const isYT = isYouTubeUrl(url); // Cek apakah URL adalah YouTube

            infoBox.classList.remove('visible');
            mediaResultBox.classList.remove('visible');
            mediaResultBox.classList.remove('no-info-box');
            
            showModal(loadingPopup);

            let data;
            try {
                const fullUrl = `${API_ENDPOINT}?url=${encodeURIComponent(url)}`;
                const options = {
                    method: "GET",
                    headers: {
                        "x-rapidapi-key": RAPID_API_KEY,
                        "x-rapidapi-host": RAPID_API_HOST
                    }
                };
                const res = await fetch(fullUrl, options);
                data = await res.json();

                if (data.error || !res.ok || !data.medias || data.medias.length === 0) {
                    throw new Error(data.message || 'Gagal memproses tautan atau tidak ada file media yang ditemukan.');
                }

                currentMediaData = data; 
                
                // --- 1. LOGIKA INFO BOX ---
                let userIdentifier = ''; 
                if (data.owner && isValidString(data.owner.username)) {
                    userIdentifier = data.owner.username.trim();
                } 
                else if (isValidString(data.username)) {
                    userIdentifier = data.username.trim();
                }
                else if (isValidString(data.unique_id)) {
                    userIdentifier = data.unique_id.trim();
                }
                
                const authorName = data.author || 'Tidak Diketahui';
                const shouldShowInfoBox = authorName !== 'Tidak Diketahui' || userIdentifier.length > 0;

                hideModal(loadingPopup); 
                
                // 2. Tampilkan Info Box jika perlu
                if (shouldShowInfoBox) {
                    const rawTitle = data.title.split('\n')[0] || "Tanpa Judul";
                    setupTitle(rawTitle); 
                    authorNameElement.textContent = authorName; 
                    authorUniqueIdElement.textContent = `@${userIdentifier.length > 0 ? userIdentifier : 'anonim'}`;
                    infoBox.classList.add('visible');
                } else {
                    infoBox.classList.remove('visible'); 
                    mediaResultBox.classList.add('no-info-box'); 
                }
                
                // --- 3. FILTER MEDIA KE DALAM KELOMPOK ---
                let mediaGroups = { visual: [], audio: [], youtubeThumbnails: [] };
                
                data.medias.forEach((media) => {
                    let downloadUrl = media.url || media.download_url;
                    if (!downloadUrl) return; 

                    // Logika penentuan tipe media
                    let mediaType = media.type;
                    if (!mediaType) {
                         const urlLower = downloadUrl.toLowerCase();
                         if (media.extension === 'mp3' || urlLower.includes('.mp3') || media.type === 'audio') {
                            mediaType = 'audio';
                         } else if (urlLower.includes('.mp4') || media.type === 'video') {
                            mediaType = 'video';
                         } else if (urlLower.includes('.jpg') || urlLower.includes('.jpeg') || urlLower.includes('.png') || media.type === 'image') {
                            mediaType = 'image';
                         }
                    }

                    if (!mediaType) return;

                    let mediaToStore = {
                        displayUrl: media.display_url || data.thumbnail,
                        downloadUrl: downloadUrl, 
                        quality: media.quality,
                        type: mediaType,
                        extension: media.extension,
                        isThumbnail: false 
                    };

                    const isDuplicate = (arr, item) => arr.some(m => m.downloadUrl === item.downloadUrl);

                    if (mediaType === 'video' || (mediaType === 'image' && !media.is_thumbnail)) {
                        if (!isDuplicate(mediaGroups.visual, mediaToStore)) {
                            mediaGroups.visual.push(mediaToStore);
                        }
                    } else if (mediaType === 'audio') {
                        if (!isDuplicate(mediaGroups.audio, mediaToStore)) {
                            mediaGroups.audio.push(mediaToStore);
                        }
                    }
                });

                // --- 4. PENAMBAHAN THUMBNAIL YOUTUBE (KHUSUS) ---
                if (isYT && data.thumbnail) {
                    const thumbnailBaseUrl = data.thumbnail.split('?')[0]; // Ambil URL bersih
                    
                    // Kualitas Thumbnail YouTube standar
                    const thumbnailQualities = [
                        { q: 'Max Resolution', url: thumbnailBaseUrl.replace('/maxresdefault.jpg', '/maxresdefault.jpg') },
                        { q: 'High Quality', url: thumbnailBaseUrl.replace('/maxresdefault.jpg', '/hqdefault.jpg') },
                        { q: 'Medium Quality', url: thumbnailBaseUrl.replace('/maxresdefault.jpg', '/mqdefault.jpg') },
                        { q: 'Standard Quality', url: thumbnailBaseUrl.replace('/maxresdefault.jpg', '/sddefault.jpg') }
                    ];

                    thumbnailQualities.forEach(thumb => {
                         mediaGroups.youtubeThumbnails.push({
                            displayUrl: thumb.url,
                            downloadUrl: thumb.url, 
                            quality: thumb.q,
                            type: 'image',
                            extension: 'jpg',
                            isThumbnail: true
                        });
                    });
                }


                // --- 5. RENDER DAN INIT PLAYER ---
                renderAllMedia(mediaGroups, data);
                mediaResultBox.classList.add('visible');
                
                // Panggil inisialisasi player setelah semua audio di-render
                initializeAudioPlayers(); 

                setTimeout(() => {
                    const targetScroll = shouldShowInfoBox ? infoBox : mediaResultBox;
                    if (targetScroll.classList.contains('visible')) {
                        targetScroll.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }, 50);

            } catch (error) {
                hideModal(loadingPopup); 
                console.error("Fetch/Processing Error:", error);
                // Diganti dari alert()
                showAlertModal(`Terjadi kesalahan: ${error.message || 'Coba lagi nanti.'}`, "Kesalahan API");
            }
        });

        // Event Listener untuk Tab Filter
        mediaFilterTabs.addEventListener('click', (e) => {
            const btn = e.target.closest('.tab-btn');
            if (btn) {
                const mediaType = btn.getAttribute('data-type');
                setActiveTab(mediaType);
            }
        });


        // ===================================================
        // EVENT LISTENERS & UTILITY LAINNYA
        // ===================================================

        // Paste Button, Theme Toggle 
        document.getElementById("pasteBtn").addEventListener("click", async () => {
            try {
              const text = await navigator.clipboard.readText();
              if (text) { tiktokUrlInput.value = text; }
            } catch (err) {
              // Diganti dari alert()
              showAlertModal("Gagal membaca clipboard. Pastikan izin diaktifkan.", "Izin Dibutuhkan");
            }
        });

        const themeToggle = document.getElementById("themeToggle");
        if (themeToggle) {
            themeToggle.addEventListener("click", () => {
                document.body.classList.toggle("dark");
                const isDark = document.body.classList.contains("dark");
                document.querySelector(".toggle-circle").innerHTML = `<i class="fa-solid ${isDark ? "fa-moon" : "fa-sun"}"></i>`;
                localStorage.setItem("theme", isDark ? "dark" : "light");
            });

            if (localStorage.getItem("theme") === "dark") {
                document.body.classList.add("dark");
                document.querySelector(".toggle-circle").innerHTML = `<i class="fa-solid fa-moon"></i>`;
            } else {
                document.querySelector(".toggle-circle").innerHTML = `<i class="fa-solid fa-sun"></i>`;
            }
        }
        
        // Drawer Logic
        document.getElementById("openDrawerBtn").addEventListener("click", openDrawer);
        document.getElementById("closeDrawerBtn").addEventListener("click", closeDrawer); 
        drawerOverlay.addEventListener("click", closeDrawer);
        
        // About Modal Logic
        showAboutModalLink.addEventListener("click", (e) => {
            e.preventDefault();
            closeDrawer();
            showModal(aboutModal); 
        });
        
        // Scroll Fade-In Logic
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                    observer.unobserve(entry.target); 
                }
            });
        }, {
            threshold: 0.1 
        });

        function checkFadeInElements() {
             document.querySelectorAll('.info-box, .media-result-box').forEach(el => {
                if (!el.classList.contains('visible')) {
                    observer.observe(el);
                }
            });
        }
        
        document.addEventListener('DOMContentLoaded', checkFadeInElements);
    </script>
</body>
</html>